<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TRACKNOVA â€“ Employee Login</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- jsQR library -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

  <style>
    :root {
      --bg: #0f1216;
      --panel: #171b22;
      --muted: #9aa3af;
      --text: #e5e7eb;
      --accent: #ff6a00;
      --ring: #2b3240;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Poppins", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .wrap {
      min-height: 100vh;
      display: grid;
      grid-template-columns: 1.2fr 0.9fr;
      gap: 24px;
      padding: 32px;
    }
    .hero {
      border-radius: 20px;
      overflow: hidden;
      background-image: url("tracknova.jpg");
      background-size: cover;
      background-position: center;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--ring);
      border-radius: 20px;
      padding: 36px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .brand { color: var(--muted); font-size:14px;}
    .title { font-size:34px; font-weight:700; }
    form { display:grid; gap:12px; }
    .field { display:grid; gap:8px; }
    label { font-size:13px; color:var(--muted); }
    input {
      width:100%; color:var(--text);
      border:1px solid var(--ring);
      border-radius:12px;
      padding:12px;
      font-size:15px;
      background:transparent;
    }
    input:focus { border-color:var(--accent); box-shadow:0 0 0 4px rgba(255,106,0,.12); }
    .btn {
      background-color:#FFA500;
      border:none; color:#fff;
      font-weight:600;
      padding:12px; border-radius:12px;
      cursor:pointer;
    }
    .btn:hover { background-color:#FFD580; }
    #video { width:100%; max-height:360px; object-fit:cover; border-radius:12px; display:none; }
    .scan-result {
      margin-top: 8px;
      padding: 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--ring);
      display:none;
    }
    .component-row { display:flex; justify-content:space-between; gap:12px; margin:6px 0; }
    .label { color:var(--muted); font-size:13px; width:40%; }
    .value { font-weight:600; text-align:right; width:60%; }
  </style>
</head>

<body>
  <main class="wrap">
    <section class="hero"></section>

    <aside class="panel">
      <div class="brand">TRACKNOVA â€¢ Indian Railways</div>
      <h1 class="title">Employee Login</h1>

      <!-- Login form -->
      <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
        <div class="field">
          <label for="userId">User ID</label>
          <input id="userId" type="text" placeholder="Enter User ID" required />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="Enter Password" required />
        </div>
        <button type="submit" class="btn">Login</button>
      </form>

      <!-- Options after login -->
      <div id="postLoginOptions" style="display:none; margin-top:20px;">
        <button id="searchBtn" class="btn">ðŸ”Ž Go to Search</button>
        <button id="scannerBtn" class="btn">ðŸ“· Open Scanner</button>
      </div>

      <!-- Video preview (camera) -->
      <video id="video" autoplay playsinline></video>
      <canvas id="canvas" style="display:none;"></canvas>

      <!-- Scan results -->
      <div id="result" class="scan-result">
        <div>Scanned component details:</div>
        <div id="componentData"></div>
        <div style="margin-top:10px;">
          <button id="closeResult" class="btn" style="background:#2b3240;">Close</button>
        </div>
      </div>
    </aside>
  </main>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const resultDiv = document.getElementById('result');
  const componentDataDiv = document.getElementById('componentData');
  const closeResult = document.getElementById('closeResult');

  let stream = null, scanning = false, rafId = null;

  // Sample data
  const componentNames = ["Elastic Rail Clip","Fishplate","Concrete Sleeper","Rail Pad","Switch Blade"];
  const manufacturers = ["ABC Rails Ltd.","RailTech Industries","National Sleepers Co."];
  const statuses = ["Operational","Good Condition","Needs Inspection","Under Maintenance"];

  // ðŸ”‘ Login
  function handleLogin() {
    const userId = document.getElementById("userId").value.trim();
    const password = document.getElementById("password").value.trim();

    if (userId === "admin" && password === "1234") {
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("postLoginOptions").style.display = "block";
    } else {
      alert("âŒ Invalid User ID or Password!");
    }
  }

  // Redirect to search
  document.getElementById("searchBtn").addEventListener("click", () => {
    window.location.href = "search.html";
  });

  // Scanner button
  document.getElementById("scannerBtn").addEventListener("click", () => {
    startScanner();
  });

  // ðŸ“· Scanner functions
  async function startScanner() {
    if (scanning) { stopScanner(); return; }
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      video.srcObject = stream;
      video.style.display = 'block';
      scanning = true;
      tick();
    } catch (err) {
      alert("âš  Camera access failed: " + err.message);
    }
  }
  function stopScanner() {
    scanning = false;
    video.style.display = 'none';
    if (stream) { stream.getTracks().forEach(t => t.stop()); stream = null; }
    if (rafId) { cancelAnimationFrame(rafId); rafId = null; }
  }
  function tick() {
    if (!scanning) return;
    const ctx = canvas.getContext('2d');
    if (video.readyState === video.HAVE_ENOUGH_DATA) {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const code = jsQR(imageData.data, imageData.width, imageData.height);
      if (code) { onQRCodeScanned(code.data); return; }
    }
    rafId = requestAnimationFrame(tick);
  }
  function onQRCodeScanned(data) {
    stopScanner();
    showComponent(data);
  }
  function showComponent(scanned) {
    const id = "CMP-" + Math.floor(10000 + Math.random() * 90000);
    const name = componentNames[Math.floor(Math.random() * componentNames.length)];
    const manufacturer = manufacturers[Math.floor(Math.random() * manufacturers.length)];
    const status = statuses[Math.floor(Math.random() * statuses.length)];
    const date = randomDate(new Date(2020,0,1), new Date()).toISOString().split('T')[0];
    componentDataDiv.innerHTML = `
      <div class="component-row"><div class="label">Component ID</div><div class="value">${id}</div></div>
      <div class="component-row"><div class="label">Name</div><div class="value">${name}</div></div>
      <div class="component-row"><div class="label">Manufacturer</div><div class="value">${manufacturer}</div></div>
      <div class="component-row"><div class="label">Date of Fitting</div><div class="value">${date}</div></div>
      <div class="component-row"><div class="label">Status</div><div class="value">${status}</div></div>
    `;
    resultDiv.style.display = 'block';
  }
  function randomDate(start, end) {
    return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
  }
  closeResult.addEventListener('click', () => { resultDiv.style.display = 'none'; });
</script>
</body>
</html>